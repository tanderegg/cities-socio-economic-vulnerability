library(rgdal)
library(sp)
library(rgeos)
library(sf)
library(lobstr)


# state level -----
geo_state <- readOGR("./data/geo/shapes/shapes/base/01_state.shp",
                     "01_state")

geo_state = st_read("./data/geo/shapes/shapes/base/01_state.shp") %>% 
  st_transform(crs = "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")

obj_size(geo_state)

geo_state_simpl <- st_simplify(geo_state, 
                               preserveTopology = FALSE, 
                               dTolerance = 1000)

obj_size(geo_state_simpl)

st_write(geo_state_simpl,
         "./data/geo/shapes/states.geojson")

# municipality level -----

geo_mun = st_read("./data/geo/shapes/shapes/base/02_mun.shp") %>% 
  st_transform(crs = "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")

obj_size(geo_mun)

geo_mun_simpl <- st_simplify(geo_mun, 
                               preserveTopology = FALSE, 
                               dTolerance = 1000)

obj_size(geo_mun_simpl)

st_write(geo_mun_simpl,
         "./data/geo/shapes/municipalities.geojson") 

# locality level -----

geo_loc = st_read("./data/geo/shapes/shapes/base/03_loc.shp") %>% 
  st_transform(crs = "+proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0")

obj_size(geo_loc)

geo_loc_simpl <- st_simplify(geo_loc, 
                             preserveTopology = FALSE, 
                             dTolerance = 100)

obj_size(geo_loc_simpl)
View(geo_loc_simpl)

st_write(geo_loc_simpl,
         "./data/geo/shapes/localities.geojson",
         append = FALSE) 

