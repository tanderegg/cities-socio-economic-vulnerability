#' Returns census values for a given query
#' @query_endpoint supplied endpoint for http query
#' @census_parameters census variables to be included in select clause
#' @where_inputs Input entity values to be included in where clause
#' @return a data table with entity level names and census variable(s)
generate_query <- function(query_endpoint,
                           census_parameters,
                           where_inputs=NULL) {
  # select query
  select_clause <- paste(paste("SELECT",
                               paste0(census_parameters, collapse = ", ")), "FROM result", collapse = "")
  
  if (!is.null(where_inputs)) {
    where_clause <- paste(select_clause,
                          "WHERE",
                          paste0(names(where_inputs), " = '", where_inputs, "'", collapse = " AND "))
  } else {
    where_clause <- select_clause
  }
  
  sql_query <- list(sql = where_clause)
  # GET response
  resp <- GET(query_endpoint, query = sql_query)
  if (http_error(resp)) {
    showNotification("API error", type = "error")
  }
  # response content
  resp_content <-
    fromJSON(content(resp, as = "text", encoding = "UTF-8"))$data
  
  bind_rows(resp_content)
}