library(sp)
library(rgeos)
library(sf)
library(lobstr)
library(rmapshaper)

# simplify mun
geo_mun = st_read("https://cities-socio-economic-vulnerability.s3.eu-west-3.amazonaws.com/mexico/boundaries/02_mun.geojson")


obj_size(geo_mun)
unique(st_geometry_type(geo_mun, by_geometry = TRUE))

geo_mun_simpl <- st_simplify(geo_mun, 
                             preserveTopology = TRUE, 
                             dTolerance = 500)

obj_size(geo_mun_simpl)

st_write(geo_mun_simpl,
         "./data/mexico/boundaries/simplified/02_mun_test.geojson",
         delete_dsn = TRUE) 

# simplify loc
geo_loc = st_read("https://cities-socio-economic-vulnerability.s3.eu-west-3.amazonaws.com/mexico/boundaries/03_loc.geojson")


object.size(geo_loc)/1000000

geo_loc_simpl <- st_simplify(geo_loc, 
                             preserveTopology = TRUE, 
                             dTolerance = 11)

geo_loc_simpl = geo_loc_simpl %>%
  select(CVEGEO,NOMGEO)

object.size(geo_loc_simpl)/1000000

test = rmapshaper::ms_simplify(geo_loc,
                               keep = 0.01,
                               keep_shapes = TRUE)

unique(st_geometry_type(geo_loc_simpl, by_geometry = TRUE))

st_write(geo_loc_simpl,
         "./data/mexico/boundaries/simplified/03_loc.geojson",
         delete_dsn = TRUE) 